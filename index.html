<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Openstack by joarder</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>Openstack</h1>
        <p>OpenStack Folsom (with Quantum) Installation Guide</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/joarder/Openstack" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/joarder/Openstack/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/joarder/Openstack/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>Controller Node Installation</h1>

<h2>MySQL Database configurations</h2>

<p><code>mysql -u root -p</code><br><code>CREATE DATABASE keystone;</code><br><code>GRANT ALL ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON keystone.* TO 'keystone'@'localhost' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON keystone.* TO 'keystone'@'192.168.0.9' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON keystone.* TO 'keystone'@'controller1-01' IDENTIFIED BY 'openstack';</code>  </p>

<p><code>CREATE DATABASE glance;</code><br><code>GRANT ALL ON glance.* TO 'glance'@'%' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON glance.* TO 'glance'@'localhost' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON glance.* TO 'glance'@'192.168.0.9' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON glance.* TO 'glance'@'controller1-01' IDENTIFIED BY 'openstack';</code>  </p>

<p><code>CREATE DATABASE cinder;</code><br><code>GRANT ALL ON cinder.* TO 'cinder'@'%' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON cinder.* TO 'cinder'@'localhost' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON cinder.* TO 'cinder'@'192.168.0.9' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON cinder.* TO 'cinder'@'controller1-01' IDENTIFIED BY 'openstack';</code>  </p>

<p><code>CREATE DATABASE quantum;</code><br><code>GRANT ALL ON quantum.* TO 'quantum'@'%' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON quantum.* TO 'quantum'@'localhost' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON quantum.* TO 'quantum'@'192.168.0.9' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON quantum.* TO 'quantum'@'controller1-01' IDENTIFIED BY 'openstack';</code>  </p>

<p><code>CREATE DATABASE nova;</code><br><code>GRANT ALL ON nova.* TO 'nova'@'%' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON nova.* TO 'nova'@'localhost' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON nova.* TO 'nova'@'192.168.0.9' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON nova.* TO 'nova'@'controller1-01' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON nova.* TO 'nova'@'192.168.0.11' IDENTIFIED BY 'openstack';</code><br><code>GRANT ALL ON nova.* TO 'nova'@'cn1-01' IDENTIFIED BY 'openstack';</code>  </p>

<h1>Network Node Installation</h1>

<h3>Install and configure common services</h3>

<hr><p><strong>Install telnet and SSH support for the compute node</strong></p>

<p><code>apt-get install telnet &amp;&amp; apt-get install openssh-server</code></p>

<p><strong>Upload the latest iproute package and install it using dpkg</strong><br>
This package update is necessary if you want to use process network namespace in future for your quantum configuration</p>

<p><code>dpkg -i iproute_20121211-2_amd64.deb</code></p>

<p><strong>Include Cloud Archives for Folsom in the system</strong></p>

<p><code>apt-get install ubuntu-cloud-keyring</code><br><code>vi /etc/apt/sources.list.d/cloud-archive.list</code>  </p>

<p><code>deb http://ubuntu-cloud.archive.canonical.com/ubuntu precise-updates/folsom main</code>  </p>

<p><strong>Update the system</strong></p>

<p><code>apt-get update &amp;&amp; apt-get dist-upgrade &amp;&amp; apt-get upgrade</code></p>

<p><strong>Install VLAN and Bridge utilities and configure NIC to support multiple networks</strong></p>

<p><code>apt-get install -y vlan bridge-utils</code><br><code>vi /etc/network/interfaces</code>  </p>

<p><code># The loopback network interface</code><br><code>auto lo</code><br><code>iface lo inet loopback</code>  </p>

<p><code># Management Network (Connected to VLAN 10)</code><br><code>auto eth0</code><br><code>iface eth0 inet static</code><br><code>address 192.168.0.10</code><br><code>netmask 255.255.255.224</code><br><code>gateway 192.168.0.1</code><br><code>dns-nameservers 4.2.2.1 4.2.2.2</code>  </p>

<p><code># VM Configuration (Connected to VLAN 101)</code><br><code>auto eth0.101</code><br><code>iface eth0.101 inet static</code><br><code>vlan-raw-device eth0</code><br><code>address 10.0.0.10</code><br><code>netmask 255.255.255.0</code>  </p>

<p><code># VM internet Access + OpenStack API (Connected to VLAN 102)</code><br><code>auto eth0.102</code><br><code>iface eth0.102 inet manual</code><br><code>vlan-raw-device eth0</code><br><code>up ifconfig $IFACE 0.0.0.0 up</code><br><code>up ip link set $IFACE promisc on</code><br><code>down ip link set $IFACE promisc off</code><br><code>down ifconfig $IFACE down</code>  </p>

<p><strong>Install and configure NTP</strong><br><code>apt-get install -y ntp</code><br><code>sed -i 's/server ntp.ubuntu.com/server ntp.ubuntu.com\nserver 127.127.1.0\nfudge 127.127.1.0 stratum 10/g' /etc/ntp.conf</code><br><code>service ntp restart</code></p>

<p><strong>Edit /etc/sysctl.conf to enable IP forwarding and disable source validation</strong><br><code>vi /etc/sysctl.conf</code>  </p>

<p><code>net.ipv4.conf.all.rp_filter = 0</code><br><code>net.ipv4.conf.default.rp_filter = 0</code><br><code>net.ipv4.ip_forward=1</code>  </p>

<p><em>If you do not want to reboot the system then just type</em><br><code>sysctl -p</code>  </p>

<p><strong>Add the below lines to your .bashrc file</strong><br><code>vi ~/.bashrc</code>  </p>

<p><code>export OS_TENANT_NAME=ADMIN</code><br><code>export OS_USERNAME=admin</code><br><code>export OS_PASSWORD=openstack</code><br><code>export OS_AUTH_URL="http://192.168.0.9:5000/v2.0/"</code><br><code>export OS_AUTH_STRATEGY=keystone</code><br><code>export SERVICE_TOKEN=ADMIN</code><br><code>export SERVICE_ENDPOINT=http://192.168.0.9:35357/v2.0/</code></p>

<p><strong>Reboot the system</strong><br>
It will be better to reboot the system at this point to make the effects into the configurations<br><code>reboot</code></p>

<h3>OpenVSwitch Configuration</h3>

<hr><p><strong>Install the required packages</strong><br><code>apt-get install -y openvswitch-switch openvswitch-datapath-dkms</code>  </p>

<p><strong>Create the bridges</strong>
<code>#br-int will be used for VM integration</code><br><code>ovs-vsctl add-br br-int</code>  </p>

<p><code>#br-ex is used to make to VM accessible from the internet</code><br><code>ovs-vsctl add-br br-ex</code><br><code>ovs-vsctl add-port br-ex eth102</code>  </p>

<h3>Quantum Configuration</h3>

<hr><p><strong>Install the Quantum openvswitch agent, l3 agent and dhcp agent</strong><br><code>apt-get -y install quantum-plugin-openvswitch-agent quantum-dhcp-agent quantum-l3-agent</code>  </p>

<p><strong>Edit /etc/quantum/api-paste.ini</strong><br><code>vi /etc/quantum/api-paste.ini</code>  </p>

<p><code>[filter:authtoken]</code><br><code>paste.filter_factory = keystone.middleware.auth_token:filter_factory</code><br><code>auth_host = 192.168.0.9</code><br><code>auth_port = 35357</code><br><code>auth_protocol = http</code><br><code>admin_tenant_name = service</code><br><code>admin_user = quantum</code><br><code>admin_password = openstack</code>  </p>

<p><strong>Edit the OVS plugin configuration file /etc/quantum/plugins/openvswitch/ovs_quantum_plugin.ini</strong><br><code>vi /etc/quantum/plugins/openvswitch/ovs_quantum_plugin.ini</code>  </p>

<p><code>#Under the database section</code><br><code>[DATABASE]</code><br><code>sql_connection = mysql://quantum:openstack@192.168.0.9/quantum</code>  </p>

<p><code>#Under the OVS section</code><br><code>[OVS]</code><br><code>tenant_network_type = gre</code><br><code>tunnel_id_ranges = 1:1000</code><br><code>integration_bridge = br-int</code><br><code>tunnel_bridge = br-tun</code><br><code>local_ip = 10.0.0.10</code><br><code>enable_tunneling = True</code>  </p>

<p><strong>In addition, update the /etc/quantum/l3_agent.ini</strong><br><code>vi /etc/quantum/l3_agent.ini</code>  </p>

<p><code>auth_url = http://192.168.0.9:35357/v2.0</code><br><code>auth_region = RegionOne</code><br><code>admin_tenant_name = service</code><br><code>admin_user = quantum</code><br><code>admin_password = openstack</code><br><code>metadata_ip = 192.168.0.130</code><br><code>metadata_port = 8775</code><br><code>use_namespaces = False</code>  </p>

<p><strong>Edit /etc/quantum/dhcp_agent.ini</strong><br><code>vi /etc/quantum/dhcp_agent.ini</code>  </p>

<p><code>use_namespaces = False</code>  </p>

<p><strong>Make sure that your RabbitMQ IP in /etc/quantum/quantum.conf is set to the controller node</strong><br><code>vi /etc/quantum/quantum.conf</code>  </p>

<p><code>rabbit_host = 192.168.0.9</code>  </p>

<p><strong>Restart all the services</strong>
<code>service quantum-plugin-openvswitch-agent restart</code><br><code>service quantum-dhcp-agent restart</code><br><code>service quantum-l3-agent restart</code>  </p>

<h1>Compute Node Installation</h1>

<h3>Install and configure common services</h3>

<hr><p><strong>Install telnet and SSH support for the compute node</strong></p>

<p><code>apt-get install telnet &amp;&amp; apt-get install openssh-server</code></p>

<p><strong>Upload the latest iproute package and install it using dpkg</strong><br>
This package update is necessary if you want to use process network namespace in future for your quantum configuration</p>

<p><code>dpkg -i iproute_20121211-2_amd64.deb</code></p>

<p><strong>Include Cloud Archives for Folsom in the system</strong></p>

<p><code>apt-get install ubuntu-cloud-keyring</code><br><code>vi /etc/apt/sources.list.d/cloud-archive.list</code>  </p>

<p><code>deb http://ubuntu-cloud.archive.canonical.com/ubuntu precise-updates/folsom main</code>  </p>

<p><strong>Update the system</strong></p>

<p><code>apt-get update &amp;&amp; apt-get dist-upgrade &amp;&amp; apt-get upgrade</code></p>

<p><strong>Install VLAN and Bridge utilities and configure NIC to support multiple networks</strong></p>

<p><code>apt-get install -y vlan bridge-utils</code><br><code>vi /etc/network/interfaces</code>  </p>

<p><code># The loopback network interface</code><br><code>auto lo</code><br><code>iface lo inet loopback</code>  </p>

<p><code># Management Network (Connected to VLAN 10)</code><br><code>auto eth0</code><br><code>iface eth0 inet static</code><br><code>address 192.168.0.11</code><br><code>netmask 255.255.255.224</code><br><code>gateway 192.168.0.1</code><br><code>dns-nameservers 4.2.2.1 4.2.2.2</code>  </p>

<p><code># VM Configuration Network (Connected to VLAN 101)</code><br><code>auto eth0.101</code><br><code>iface eth0.101 inet static</code><br><code>vlan-raw-device eth0</code><br><code>address 10.0.0.11</code><br><code>netmask 255.255.255.0</code>  </p>

<p><strong>Install and configure NTP</strong><br><code>apt-get install -y ntp</code><br><code>sed -i 's/server ntp.ubuntu.com/server ntp.ubuntu.com\nserver 127.127.1.0\nfudge 127.127.1.0 stratum 10/g' /etc/ntp.conf</code><br><code>service ntp restart</code></p>

<p><strong>Edit /etc/sysctl.conf to enable IP forwarding and disable source validation</strong><br><code>vi /etc/sysctl.conf</code>  </p>

<p><code>net.ipv4.conf.all.rp_filter = 0</code><br><code>net.ipv4.conf.default.rp_filter = 0</code><br><code>net.ipv4.ip_forward=1</code>  </p>

<p><em>If you do not want to reboot the system then just type</em><br><code>sysctl -p</code>  </p>

<p><strong>Add the below lines to your .bashrc file</strong><br><code>vi ~/.bashrc</code>  </p>

<p><code>export OS_TENANT_NAME=ADMIN</code><br><code>export OS_USERNAME=admin</code><br><code>export OS_PASSWORD=openstack</code><br><code>export OS_AUTH_URL="http://192.168.0.9:5000/v2.0/"</code><br><code>export OS_AUTH_STRATEGY=keystone</code><br><code>export SERVICE_TOKEN=ADMIN</code><br><code>export SERVICE_ENDPOINT=http://192.168.0.9:35357/v2.0/</code></p>

<p><strong>Reboot the system</strong><br>
It will be better to reboot the system at this point to make the effects into the configurations<br><code>reboot</code></p>

<h3>Install and configure KVM Hypervisor</h3>

<hr><p><strong>Install the required packages</strong><br><code>apt-get install -y kvm libvirt-bin pm-utils</code>  </p>

<p><strong>Configure libvirt</strong><br>
Edit /etc/libvirt/qemu.conf file and add :<br><code>vi /etc/libvirt/qemu.conf</code>  </p>

<p><code>cgroup_device_acl = [</code><br><code>"/dev/null", "/dev/full", "/dev/zero",</code><br><code>"/dev/random", "/dev/urandom",</code><br><code>"/dev/ptmx", "/dev/kvm", "/dev/kqemu",</code><br><code>"/dev/rtc", "/dev/hpet", "/dev/net/tun"]</code>  </p>

<p><strong>Disable KVM default virtual bridge to avoid any confusion</strong><br><code>virsh net-destroy default</code><br><code>virsh net-undefine default</code>  </p>

<p><strong>Allow Live Migrations</strong><br>
Edit /etc/libvirt/libvirtd.conf file :<br><code>vi /etc/libvirt/libvirtd.conf</code>  </p>

<p><code>listen_tls = 0</code><br><code>listen_tcp = 1</code><br><code>auth_tcp = "none"</code>  </p>

<p><strong>Modify libvirtd_opts variable in /etc/init/libvirt-bin.conf file</strong><br><code>vi /etc/init/libvirt-bin.conf</code>  </p>

<p><code>env libvirtd_opts="-d -l"</code>  </p>

<p><strong>Edit /etc/default/libvirt-bin file</strong><br><code>vi /etc/default/libvirt-bin</code>  </p>

<p><code>libvirtd_opts="-d -l"</code>  </p>

<p><strong>Restart libvirt</strong><br><code>service libvirt-bin restart</code>  </p>

<h3>Install and configure OpenVSwitch</h3>

<hr><p><strong>Install the openVSwitch</strong><br><code>apt-get install -y openvswitch-switch openvswitch-datapath-dkms</code>  </p>

<p><strong>Create the bridges (br-int will be used for VM integration)</strong><br><code>ovs-vsctl add-br br-int</code>  </p>

<h3>Install the Quantum OpenVSwitch agent</h3>

<p><strong>Install the required packages</strong><br><code>apt-get -y install quantum-plugin-openvswitch-agent</code>  </p>

<p><strong>Edit the OVS plugin configuration file /etc/quantum/plugins/openvswitch/ovs_quantum_plugin.ini with:</strong><br><code>vi /etc/quantum/plugins/openvswitch/ovs_quantum_plugin.ini</code>  </p>

<p><code>#Under the database section</code><br><code>[DATABASE]</code><br><code>sql_connection = mysql://quantum:openstack@192.168.0.9/quantum</code>  </p>

<p><code>#Under the OVS section</code><br><code>[OVS]</code><br><code>tenant_network_type = gre</code><br><code>tunnel_id_ranges = 1:1000</code><br><code>integration_bridge = br-int</code><br><code>tunnel_bridge = br-tun</code><br><code>local_ip = 10.0.0.11</code><br><code>enable_tunneling = True</code>  </p>

<p><strong>Make sure that your rabbitMQ IP in /etc/quantum/quantum.conf is set to the controller node:</strong><br><code>vi /etc/quantum/quantum.conf</code>  </p>

<p><code>rabbit_host = 192.168.0.9</code>  </p>

<p><strong>Restart all the services:</strong><br><code>service quantum-plugin-openvswitch-agent restart</code>  </p>

<h3>Install and configure Nova services</h3>

<hr><p><strong>Install the required packages:</strong><br><code>apt-get install nova-compute-kvm</code>  </p>

<p><strong>Now modify authtoken section in the /etc/nova/api-paste.ini file to this:</strong><br><code>vi /etc/nova/api-paste.ini</code>  </p>

<p><code>[filter:authtoken]</code><br><code>paste.filter_factory = keystone.middleware.auth_token:filter_factory</code><br><code>auth_host = 192.168.0.9</code><br><code>auth_port = 35357</code><br><code>auth_protocol = http</code><br><code>admin_tenant_name = service</code><br><code>admin_user = nova</code><br><code>admin_password = openstack</code><br><code>signing_dirname = /tmp/keystone-signing-nova</code>  </p>

<p><strong>Edit /etc/nova/nova-compute.conf file</strong><br><code>vi /etc/nova/nova-compute.conf</code>  </p>

<p><code>[DEFAULT]</code><br><code>libvirt_type=kvm</code><br><code>libvirt_ovs_bridge=br-int</code><br><code>libvirt_vif_type=ethernet</code><br><code>libvirt_vif_driver=nova.virt.libvirt.vif.LibvirtHybridOVSBridgeDriver</code><br><code>libvirt_use_virtio_for_bridges=True</code>  </p>

<p><strong>Modify the /etc/nova/nova.conf like this:</strong><br><code>vi /etc/nova/nova.conf</code>  </p>

<p><code>[DEFAULT]</code><br><code>logdir=/var/log/nova</code><br><code>state_path=/var/lib/nova</code><br><code>lock_path=/run/lock/nova</code><br><code>verbose=True</code><br><code>api_paste_config=/etc/nova/api-paste.ini</code><br><code>scheduler_driver=nova.scheduler.simple.SimpleScheduler</code><br><code>s3_host=192.168.0.9</code><br><code>ec2_host=192.168.0.9</code><br><code>ec2_dmz_host=192.168.0.9</code><br><code>rabbit_host=192.168.0.9</code><br><code>cc_host=192.168.0.9</code><br><code>dmz_cidr=169.254.169.254/32</code><br><code>metadata_host=192.168.0.9</code><br><code>metadata_listen=0.0.0.0</code><br><code>nova_url=http://192.168.0.9:8774/v1.1/</code><br><code>sql_connection=mysql://nova:openstack@192.168.0.9/nova</code><br><code>ec2_url=http://192.168.0.9:8773/services/Cloud</code><br><code>root_helper=sudo nova-rootwrap /etc/nova/rootwrap.conf</code>  </p>

<p><code># Authentication</code><br><code>use_deprecated_auth=false</code><br><code>auth_strategy=keystone</code><br><code>keystone_ec2_url=http://192.168.0.9:5000/v2.0/ec2tokens</code>  </p>

<p><code># Imaging service</code><br><code>glance_api_servers=192.168.0.9:9292</code><br><code>image_service=nova.image.glance.GlanceImageService</code>  </p>

<p><code># VNC configuration</code><br><code>novnc_enabled=true</code><br><code>novncproxy_base_url=http://192.168.0.130:6080/vnc_auto.html</code><br><code>novncproxy_port=6080</code><br><code>vncserver_proxyclient_address=192.168.0.11</code><br><code>vncserver_listen=0.0.0.0</code>  </p>

<p><code># Network settings</code><br><code>network_api_class=nova.network.quantumv2.api.API</code><br><code>quantum_url=http://192.168.0.9:9696</code><br><code>quantum_auth_strategy=keystone</code><br><code>quantum_admin_tenant_name=service</code><br><code>quantum_admin_username=quantum</code><br><code>quantum_admin_password=openstack</code><br><code>quantum_admin_auth_url=http://192.168.0.9:35357/v2.0</code><br><code>libvirt_vif_driver=nova.virt.libvirt.vif.LibvirtHybridOVSBridgeDriver</code><br><code>linuxnet_interface_driver=nova.network.linux_net.LinuxOVSInterfaceDriver</code><br><code>firewall_driver=nova.virt.libvirt.firewall.IptablesFirewallDriver</code>  </p>

<p><code># Compute</code><br><code>compute_driver=libvirt.LibvirtDriver</code>  </p>

<p><code># Cinder</code><br><code>volume_api_class=nova.volume.cinder.API</code><br><code>osapi_volume_listen_port=5900</code>  </p>

<p><strong>Restart nova-* services:</strong><br><code>cd /etc/init.d/; for i in $( ls nova-* ); do service $i restart; done</code>  </p>

<p><strong>Check for the smiling faces on nova-* services to confirm your installation:</strong><br><code>nova-manage service list</code>  </p>

<h1>Credits:</h1>

<ol>
<li><a href="http://docs.openstack.org/folsom/basic-install/content/">Official Guide: Basic Installation Guide for Ubuntu 12.04/12.10 (Folsom)</a></li>
<li><a href="http://docwiki.cisco.com/wiki/Cisco_OpenStack_Edition:_Folsom_Manual_Install">Cisco OpenStack Edition: Folsom Manual Install</a></li>
<li><a href="https://github.com/mseknibilel/OpenStack-Folsom-Install-guide/blob/stable/GRE/OpenStack_Folsom_Install_Guide_WebVersion.rst">Folsom + Quantum on GRE-Tunneling with 3 NIC</a></li>
</ol>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/joarder">joarder</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>